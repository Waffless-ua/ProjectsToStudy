<UserControl x:Class="ArcadeGameWPF.Views.GameEnvironment"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ArcadeGameWPF.Views"
             xmlns:convr="clr-namespace:ArcadeGameWPF.Converters"
             
             
             Focusable="True"
             KeyDown="UserControl_KeyDown"
             KeyUp="UserControl_KeyUp"
             
             Padding="5">

    <UserControl.Resources>
        <convr:HealthToHeartsConverter x:Key="HealthToHeartsConverter"/>
    </UserControl.Resources>

    <Grid>
        <Canvas 
        VerticalAlignment="Center" HorizontalAlignment="Center"
        Width="{Binding MapSizeX}"
        Height="{Binding MapSizeY}"
        Background="Black" >

            <Rectangle 
                x:Name="Player"
                Height="{Binding Player.SizeY}"
                Width="{Binding Player.SizeX}"
                Canvas.Left="{Binding Player.PositionX}"
                Canvas.Top="{Binding Player.PositionY}"
                Fill="Green"
                Stroke="White"
                StrokeThickness="3">
            </Rectangle>

            <ItemsControl ItemsSource="{Binding Enemies}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemContainerStyle>
                    <Style>
                        <Setter Property="Canvas.Left" Value="{Binding PositionX}" />
                        <Setter Property="Canvas.Top" Value="{Binding PositionY}" />
                    </Style>
                </ItemsControl.ItemContainerStyle>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Rectangle
                    Width="{Binding SizeX}"
                    Height="{Binding SizeY}"
                    Fill="Red" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <ItemsControl ItemsSource="{Binding Bullets}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemContainerStyle>
                    <Style>
                        <Setter Property="Canvas.Left" Value="{Binding PositionX}" />
                        <Setter Property="Canvas.Top" Value="{Binding PositionY}" />
                    </Style>
                </ItemsControl.ItemContainerStyle>


                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Ellipse
                    Width="{Binding SizeX}"
                    Height="{Binding SizeY}"
                    Canvas.Left="{Binding PositionX}"
                    Canvas.Top="{Binding PositionY}"
                    Fill="Yellow"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Canvas>

        <TextBlock 
            HorizontalAlignment="Left"
            VerticalAlignment="Bottom"
            Margin="10"
            FontSize="55"
            Foreground="Red"
            Text="{Binding Player.Health, Converter={StaticResource HealthToHeartsConverter}}"/>
    </Grid>
    
  
    <UserControl.InputBindings>
        <KeyBinding Key="A"
                Command="{Binding MoveCommand}"
                CommandParameter="Left"/>

        <KeyBinding Key="D"
                Command="{Binding MoveCommand}"
                CommandParameter="Right"/>

        <KeyBinding Key="W"
                Command="{Binding MoveCommand}"
                CommandParameter="Up"/>

        <KeyBinding Key="S"
                Command="{Binding MoveCommand}"
                CommandParameter="Down"/>
    </UserControl.InputBindings>
</UserControl>
